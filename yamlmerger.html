<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Merge Item YAML Files</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import * as YAML from "https://cdn.skypack.dev/yaml";

    window.safeParseYaml = (text) => {
      try {
        return YAML.parse(text, { prettyErrors: true, uniqueKeys: false });
      } catch (e) {
        console.warn("YAML parse warning:", e);
        return YAML.parseDocument(text, { prettyErrors: true, uniqueKeys: false }).toJSON() || {};
      }
    };

    window.mergeYamlFiles = async () => {
      const files = [
        document.getElementById('yaml1').files[0],
        document.getElementById('yaml2').files[0],
        document.getElementById('yaml3').files[0],
        document.getElementById('yaml4').files[0],
        document.getElementById('yaml5').files[0]
      ].filter(Boolean);

      if (files.length === 0) {
        alert("Please select at least one YAML file.");
        return;
      }

      const readFile = (file) => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsText(file);
      });

      const merged = {
        Header: { Type: "ITEM_DB", Version: 3 },
        Body: []
      };

      for (let file of files) {
        const content = await readFile(file);
        const parsed = window.safeParseYaml(content);
        if (parsed && Array.isArray(parsed.Body)) {
            for (const item of parsed.Body) {
            merged.Body.push({
                Id: item.Id,
                AegisName: item.AegisName,
                Name: item.Name,
                Type: item.Type,
                SubType: item.SubType
            });
            }
        }
      }


      const outputYaml = YAML.stringify(merged);
      document.getElementById("outputBox").textContent = outputYaml;
      window.finalYaml = outputYaml;
      document.getElementById("downloadBtn").classList.remove("hidden");
    };

    window.downloadYaml = () => {
      const blob = new Blob([window.finalYaml], { type: "text/yaml" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "merged_items.yaml";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    };
  </script>
</head>
<body class="bg-gray-100 p-6">
  

<!-- Floating Sidebar -->
<div class="fixed top-0 left-0 h-full w-64 bg-gray-800 text-white shadow-lg z-50">
  <div class="p-4 border-b border-gray-700 text-xl font-bold">Pickup Planner</div>
  
  <div class="p-4">
    <div class="mb-2 font-semibold text-gray-300">Tools:</div>
    <ul class="space-y-1 ml-2 text-sm">
      <li><a href="pickupplanner.html" class="hover:text-blue-300">Pickup Planner</a></li>
      <li><a href="dbgenerator.html" class="hover:text-blue-300">Monster Drop Extractor</a></li>
      <li><a href="yamlmerger.html" class="hover:text-blue-300">Item DB YAML Merger</a></li>
    </ul>

    <div class="mt-4 mb-2 font-semibold text-gray-300">Files:</div>
    <ul class="space-y-1 ml-2 text-sm">
      <li><a target="_blank" href="inputs/monster_drops.json" class="hover:text-blue-300">- monster_drops.json</a></li>
      <li><a target="_blank" href="inputs/monsterlist.txt" class="hover:text-blue-300">- monsterlist.txt</a></li>
      <li><a target="_blank" href="inputs/cleaned_mob_db.yml" class="hover:text-blue-300">- cleaned_mob_db.yml</a></li>
      <li><a target="_blank" href="inputs/merged_items.yml" class="hover:text-blue-300">- merged_items.yml</a></li>
      <li><a target="_blank" href="inputs/item_db_etc.yml" class="hover:text-blue-300">- item_db_etc.yml</a></li>
    </ul>


    <div class="mt-4 mb-2 font-semibold text-gray-300">Bottable Servers (RateMyServer links):</div>
    <ul class="space-y-1 ml-2 text-sm">
      <li><a target="_blank" href="https://rms101.com/index.php?page=detailedlistserver&serid=22939&itv=6&url_sname=Bot%20Party" class="hover:text-blue-300">Bot Party!</a></li>
      <li><a target="_blank" href="https://rms101.com/index.php?page=detailedlistserver&serid=22233&itv=6&url_sname=Asgards%20Glory" class="hover:text-blue-300">Asgards Glory</a></li>
    </ul>

    <div class="mt-4 mb-2 font-semibold text-gray-300">About</div>
    <small>Tools made for Openkore QOL by <a href="https://github.com/junoxjuno">junoxjuno</a></small>

  </div>
</div>

<!-- Add margin-left to your page content -->
<div class="ml-64">
  <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-6 space-y-6">
    <h1 class="text-2xl font-bold text-gray-800">Merge Item YAML Files</h1>
    <p>Merge your <code>item_db_equip.yml</code>, <code>item_db_etc.yml</code>, <code>item_db_usable.yml</code> with ease.</p>

    <div class="space-y-4">
      <div>
        <label class="block font-semibold text-gray-700">Item YAML File 1:</label>
        <input type="file" id="yaml1" accept=".yaml,.yml" class="border p-2 rounded w-full">
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Item YAML File 2:</label>
        <input type="file" id="yaml2" accept=".yaml,.yml" class="border p-2 rounded w-full">
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Item YAML File 3:</label>
        <input type="file" id="yaml3" accept=".yaml,.yml" class="border p-2 rounded w-full">
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Item YAML File 4:</label>
        <input type="file" id="yaml4" accept=".yaml,.yml" class="border p-2 rounded w-full">
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Item YAML File 5:</label>
        <input type="file" id="yaml5" accept=".yaml,.yml" class="border p-2 rounded w-full">
      </div>
    </div>

    <button onclick="mergeYamlFiles()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow">
      Merge and Show Output
    </button>

    <div>
      <h2 class="text-lg font-semibold mt-6">Merged YAML Output:</h2>
      <pre id="outputBox" class="mt-2 p-4 bg-gray-900 text-white rounded max-h-[400px] overflow-auto text-sm whitespace-pre-wrap"></pre>
    </div>

    <button id="downloadBtn" onclick="downloadYaml()" class="hidden bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
      Download Merged YAML
    </button>
  </div>
</div>


  
</body>
</html>
